---
title: "Assignment 2"
author: ~~Hari Subhash~~ Mario 
date: "Date created: `r Sys.Date()`"
output:
  html_notebook:
    highlight: kate
    smart: yes
    theme: cosmo
    code_folding: show
    df_print: paged
    toc: true
    toc_depth: 2
---

## Abstract

Unpredictable flight delays are a costly problem, forcing travelers to choose between . In 2013, flights from the three New York area airports alone saw aggregate delays of half a million minutes.

## Background

**PROBLEM:** Here, the problem is that flight delays are unpredictable. Not only that, mis-timing your ride to the airport could be costly; Arrive late and you may miss your flight altogether, but arrive early and you'll spend even more uncomfortable, unproductive time at the gate

**GOAL:** My ultimate goal is to be able to best predict a flight's departure delay. In an ideal world, all flights would simply leave on time. In a second-best world, each airline would contact travelers directly with flight delay information that was accurate and timely enough to be actionable. Alas, neither of those are the case and so in the world we live in, my goal is to better predict delay using weather and flight data.

**HYPOTHESIS:** My null hypothesis is that *no* available weather or flight data shares a relationship with flight delay. 


## Setting up

To set up, I'll do the following:

1. Install and enable the packages that will help explore, manipulate, and analyze the data
2. Join flight data with corresponding weather data 
3. 

```{r}
### Install packages, as needed 
# install.packages('tidyverse') 
# install.packages('skimr') 
# install.package('lubridate')
# install.packages('Hmisc')

# This line enables relevant packages
library(tidyverse); library(skimr); library(nycflights13); library(lubridate); library(Hmisc) 

### This joins flight and weather data, storing it in the new data frame we'll work with
flt_wx <- flights %>%
  left_join(weather,by = c('origin','time_hour')) %>%
  group_by(carrier) %>%
  mutate(is_wkend = if_else(wday(as.Date(time_hour)) == 1 
            | wday(as.Date(time_hour)) == 7,1,0)
        ,near_20 = abs(hour.x - 20)
		    ,decness = abs(month.x - 6)
		    ,dep_delay = if_else(dep_delay<0,0,dep_delay)
        ,carr_delay = mean(dep_delay,na.rm = T)-mean(flights$dep_delay,na.rm = T)) %>%
  ungroup() %>%
  select(dep_delay,temp:carr_delay)

flt_wx

```

```{r}
flt_wx %>%
  cor(use = 'pairwise.complete.obs', method = 'pearson') %>%
  round(2) %>%
  as.data.frame() %>%
  select(1) %>%
  cbind(rownames(.),.) %>%
  filter(dep_delay > -1 & dep_delay < 1) %>%
  arrange(desc(abs(dep_delay)))


flt_wx

skim(flights$dep_delay)
skim(flights$dep_delay[flights$dep_delay>0])




flt_wx

flt_wx %>%
  cor(use = 'pairwise.complete.obs',method = 'pearson') %>%
  round(2) %>%
  as.data.frame() %>%
  select(1) %>%
  cbind(rownames(.),.) %>%
  filter(dep_delay > 0 & dep_delay < 1) %>%
  arrange(desc(dep_delay))

flights %>%
  mutate(diff_20 = abs(hour-20)) %>% 
  select(dep_delay,hour,diff_20) %>%
  group_by(diff_20) %>%
  summarize(mean_delay = mean(dep_delay, na.rm = T)) %>%
#  arrange(desc(mean_delay)) %>%
#  cor(use = 'pairwise.complete.obs',method = 'pearson')
#
  ggplot(data = .,mapping = aes(x=diff_20,y=mean_delay)) +
  geom_point() +
  geom_smooth(method = lm)



  
    cor(use = 'pairwise.complete.obs',method = 'pearson')



#
  ggplot(data = .,mapping = aes(x=wkday,y=mean_delay)) +
  geom_point() +
  geom_smooth(method = loess)
  

flights %>%
  mutate(diff_20 = abs(hour-20)) %>% 
  select(dep_delay,hour,diff_20) %>%
  group_by(diff_20) %>%
  summarize(mean_delay = mean(dep_delay, na.rm = T))

    
```

